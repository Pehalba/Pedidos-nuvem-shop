<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Teste de Sele√ß√£o</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="container mt-4">
      <h2>Teste de Sele√ß√£o M√∫ltipla</h2>

      <form id="formTeste" method="POST">
        <div class="mb-3">
          <label for="acao" class="form-label">A√ß√£o:</label>
          <select class="form-select" id="acao" name="acao" required>
            <option value="">Selecione uma a√ß√£o...</option>
            <option value="excluir">üóëÔ∏è Excluir Pedidos</option>
            <option value="remover_grupos">‚ùå Remover de Grupos</option>
          </select>
        </div>

        <button
          type="submit"
          class="btn btn-warning"
          id="btnExecutarAcao"
          disabled
        >
          <i class="fas fa-play me-1"></i>Executar A√ß√£o
        </button>

        <button
          type="button"
          class="btn btn-outline-secondary"
          id="btnSelecionarTodos"
        >
          <i class="fas fa-check-square me-1"></i>Selecionar Todos
        </button>
      </form>

      <table class="table table-striped mt-4">
        <thead>
          <tr>
            <th width="50">
              <input type="checkbox" id="checkTodos" class="form-check-input" />
            </th>
            <th>ID</th>
            <th>Nome</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>
              <input
                type="checkbox"
                name="pedidos_selecionados"
                value="1"
                class="form-check-input check-pedido"
              />
            </td>
            <td>1</td>
            <td>Pedido 1</td>
          </tr>
          <tr>
            <td>
              <input
                type="checkbox"
                name="pedidos_selecionados"
                value="2"
                class="form-check-input check-pedido"
              />
            </td>
            <td>2</td>
            <td>Pedido 2</td>
          </tr>
          <tr>
            <td>
              <input
                type="checkbox"
                name="pedidos_selecionados"
                value="3"
                class="form-check-input check-pedido"
              />
            </td>
            <td>3</td>
            <td>Pedido 3</td>
          </tr>
        </tbody>
      </table>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const checkTodos = document.getElementById("checkTodos");
        const checksPedidos = document.querySelectorAll(".check-pedido");
        const acaoSelect = document.getElementById("acao");
        const btnExecutarAcao = document.getElementById("btnExecutarAcao");
        const btnSelecionarTodos =
          document.getElementById("btnSelecionarTodos");
        const formTeste = document.getElementById("formTeste");

        // Checkbox "Selecionar Todos"
        checkTodos.addEventListener("change", function () {
          const isChecked = this.checked;
          checksPedidos.forEach((check) => {
            check.checked = isChecked;
          });
          atualizarBotaoExecutar();
        });

        // Checkboxes individuais
        checksPedidos.forEach((check) => {
          check.addEventListener("change", function () {
            atualizarCheckTodos();
            atualizarBotaoExecutar();
          });
        });

        // Selecionar Todos (bot√£o)
        btnSelecionarTodos.addEventListener("click", function () {
          const pedidosVisiveis = Array.from(checksPedidos);

          if (pedidosVisiveis.some((check) => !check.checked)) {
            // Selecionar todos os vis√≠veis
            pedidosVisiveis.forEach((check) => (check.checked = true));
            btnSelecionarTodos.innerHTML =
              '<i class="fas fa-square me-1"></i>Desselecionar Todos';
          } else {
            // Desselecionar todos
            pedidosVisiveis.forEach((check) => (check.checked = false));
            btnSelecionarTodos.innerHTML =
              '<i class="fas fa-check-square me-1"></i>Selecionar Todos';
          }

          atualizarCheckTodos();
          atualizarBotaoExecutar();
        });

        // Mudan√ßa na a√ß√£o selecionada
        acaoSelect.addEventListener("change", function () {
          atualizarBotaoExecutar();
        });

        // Confirma√ß√£o antes de executar a√ß√£o
        formTeste.addEventListener("submit", function (e) {
          const acao = acaoSelect.value;
          const pedidosSelecionados = document.querySelectorAll(
            ".check-pedido:checked"
          );

          if (pedidosSelecionados.length === 0) {
            e.preventDefault();
            alert("Selecione pelo menos um pedido!");
            return;
          }

          let mensagem = "";
          switch (acao) {
            case "excluir":
              mensagem = `Tem certeza que deseja excluir ${pedidosSelecionados.length} pedido(s)?`;
              break;
            case "remover_grupos":
              mensagem = `Tem certeza que deseja remover ${pedidosSelecionados.length} pedido(s) de seus grupos?`;
              break;
          }

          if (!confirm(mensagem)) {
            e.preventDefault();
          } else {
            alert("A√ß√£o executada com sucesso!");
            e.preventDefault();
          }
        });

        // Fun√ß√µes auxiliares
        function atualizarCheckTodos() {
          const pedidosVisiveis = Array.from(checksPedidos);
          const pedidosSelecionados = pedidosVisiveis.filter(
            (check) => check.checked
          );

          if (pedidosSelecionados.length === 0) {
            checkTodos.checked = false;
            checkTodos.indeterminate = false;
          } else if (pedidosSelecionados.length === pedidosVisiveis.length) {
            checkTodos.checked = true;
            checkTodos.indeterminate = false;
          } else {
            checkTodos.checked = false;
            checkTodos.indeterminate = true;
          }
        }

        function atualizarBotaoExecutar() {
          const pedidosSelecionados = document.querySelectorAll(
            ".check-pedido:checked"
          );
          const acao = acaoSelect.value;

          if (pedidosSelecionados.length > 0 && acao) {
            btnExecutarAcao.disabled = false;

            // Atualizar texto do bot√£o
            let texto = "";
            switch (acao) {
              case "excluir":
                texto = `üóëÔ∏è Excluir ${pedidosSelecionados.length} Pedido(s)`;
                break;
              case "remover_grupos":
                texto = `‚ùå Remover ${pedidosSelecionados.length} de Grupo(s)`;
                break;
            }
            btnExecutarAcao.innerHTML = `<i class="fas fa-play me-1"></i>${texto}`;
          } else {
            btnExecutarAcao.disabled = true;
            btnExecutarAcao.innerHTML =
              '<i class="fas fa-play me-1"></i>Executar A√ß√£o';
          }
        }
      });
    </script>
  </body>
</html>
